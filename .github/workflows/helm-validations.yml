# This action checks the Helm Chart changes for linting and version updates
name: helm-validations

# Check runs on PRs created to merge to main branch
on:
  pull_request:
    branches: [ main ]

jobs:
  # This job will run helm lint and version increment check on updated charts
  lint:
    runs-on: ubuntu-latest

    steps:
      # Check out the repo
      - name: Checkout
        uses: actions/checkout@v2
        with: 
         fetch-depth: "0"
         
      # Lint and version increment checks on updated charts   
      - name: Run lint/version increment checks
        id: versionIncrement
        uses: helm/chart-testing-action@v1.0.0
        with:
          command: lint
          config: lintConfig.yaml
 
 # This job checks that dependency versions have been updated on the main karavi chart
  dependency:
    runs-on: ubuntu-latest
    steps:
      # Check out the repo
      - name: Checkout
        uses: actions/checkout@v2
        with: 
         fetch-depth: "0"
         
      # Run a check on main karavi chart for updated dependency versions
      - name: Run dependency version checks
        id: lint
        uses: helm/chart-testing-action@v1.0.0
        with:
          command: lint
          config: dependencyConfig.yaml
